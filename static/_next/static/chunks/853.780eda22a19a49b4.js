"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[853],{8853:function(t,e,i){i.r(e);var n=i(7437),s=i(2265),o=i(2079),r=i(1448),a=i(8906);let h={distortion:"turbulentDistortion",length:400,roadWidth:10,islandWidth:2,lanesPerRoad:4,fov:70,fovSpeedUp:150,speedUp:2,carLightsFade:.8,totalSideLightSticks:15,lightPairsPerRoadWay:40,shoulderLinesWidthPercentage:.05,brokenLinesWidthPercentage:.1,brokenLinesLengthPercentage:.5,lightStickWidth:[.12,.4],lightStickHeight:[1.3,1.7],movingAwaySpeed:[8,12],movingCloserSpeed:[-12,-18],carLightsLength:[60,200],carLightsRadius:[.03,.08],carWidthPercentage:[.3,.5],carShiftX:[-.6,.6],carFloorSeparation:[0,3],colors:{roadColor:657930,islandColor:657930,background:0,shoulderLines:55715,brokenLines:55715,leftCars:[55715,1096065,366185],rightCars:[55715,1096065,366185],sticks:55715}};function l(t){return .5*Math.sin(t)+.5}let d={uFreq:{value:new o.Ltg(2,4,4,1)},uAmp:{value:new o.Ltg(8,2,4,4)}},c={turbulentDistortion:{uniforms:d,getDistortion:"\n    uniform vec4 uFreq;\n    uniform vec4 uAmp;\n    float nsin(float val){\n      return sin(val) * 0.5 + 0.5;\n    }\n    #define PI 3.14159265358979\n    float getDistortionX(float progress){\n      return (\n        cos(PI * progress * uFreq.r + uTime) * uAmp.r +\n        pow(cos(PI * progress * uFreq.g + uTime * (uFreq.g / uFreq.r)), 2. ) * uAmp.g\n      );\n    }\n    float getDistortionY(float progress){\n      return (\n        -nsin(PI * progress * uFreq.b + uTime) * uAmp.b +\n        -pow(nsin(PI * progress * uFreq.a + uTime / (uFreq.b / uFreq.a)), 5.) * uAmp.a\n      );\n    }\n    vec3 getDistortion(float progress){\n      return vec3(\n        getDistortionX(progress) - getDistortionX(0.0125),\n        getDistortionY(progress) - getDistortionY(0.0125),\n        0.\n      );\n    }\n  ",getJS:(t,e)=>{let i=d.uFreq.value,n=d.uAmp.value,s=t=>Math.cos(Math.PI*t*i.x+e)*n.x+Math.pow(Math.cos(Math.PI*t*i.y+i.y/i.x*e),2)*n.y,r=t=>-l(Math.PI*t*i.z+e)*n.z-Math.pow(l(Math.PI*t*i.w+e/(i.z/i.w)),5)*n.w,a=new o.Pa4(s(t)-s(t+.007),r(t)-r(t+.007),0),h=new o.Pa4(-.5,-1,0),c=new o.Pa4(0,0,-10);return a.multiply(h).add(c)}}};function u(t){return Array.isArray(t)?Math.random()*(t[1]-t[0])+t[0]:Math.random()*t}function f(t){return Array.isArray(t)?t[Math.floor(Math.random()*t.length)]:t}function g(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001,s=(e-t)*i;return Math.abs(s)<n&&(s=e-t),s}class m{init(){let t;let e=this.options,i=new o.U7(new o.Pa4(0,0,0),new o.Pa4(0,0,-1)),n=new o.WXh(i,40,1,8,!1),s=new o.L5s().copy(n);s.instanceCount=2*e.lightPairsPerRoadWay;let r=e.roadWidth/e.lanesPerRoad,a=[],h=[],l=[];t=Array.isArray(this.colors)?this.colors.map(t=>new o.Ilk(t)):[new o.Ilk(this.colors)];for(let i=0;i<e.lightPairsPerRoadWay;i++){let n=u(e.carLightsRadius),s=u(e.carLightsLength),o=u(this.speed),d=i%e.lanesPerRoad*r-e.roadWidth/2+r/2,c=u(e.carWidthPercentage)*r;d+=u(e.carShiftX)*r;let g=u(e.carFloorSeparation)+1.3*n,m=-u(e.length);a.push(d-c/2),a.push(g),a.push(m),a.push(d+c/2),a.push(g),a.push(m),h.push(n),h.push(s),h.push(o),h.push(n),h.push(s),h.push(o);let p=f(t);l.push(p.r),l.push(p.g),l.push(p.b),l.push(p.r),l.push(p.g),l.push(p.b)}s.setAttribute("aOffset",new o.lb7(new Float32Array(a),3,!1)),s.setAttribute("aMetrics",new o.lb7(new Float32Array(h),3,!1)),s.setAttribute("aColor",new o.lb7(new Float32Array(l),3,!1));let d=new o.jyz({fragmentShader:p,vertexShader:v,transparent:!0,uniforms:Object.assign({uTime:{value:0},uTravelLength:{value:e.length},uFade:{value:this.fade}},this.webgl.fogUniforms,("object"==typeof this.options.distortion?this.options.distortion.uniforms:{})||{})});d.onBeforeCompile=t=>{t.vertexShader=t.vertexShader.replace("#include <getDistortion_vertex>","object"==typeof this.options.distortion?this.options.distortion.getDistortion:"")};let c=new o.Kj0(s,d);c.frustumCulled=!1,this.webgl.scene.add(c),this.mesh=c}update(t){this.mesh.material.uniforms.uTime&&(this.mesh.material.uniforms.uTime.value=t)}constructor(t,e,i,n,s){this.webgl=t,this.options=e,this.colors=i,this.speed=n,this.fade=s}}let p="\n  #define USE_FOG;\n  ".concat(r.WdD.fog_pars_fragment,"\n  varying vec3 vColor;\n  varying vec2 vUv;\n  uniform vec2 uFade;\n  void main() {\n    vec3 color = vec3(vColor);\n    float alpha = smoothstep(uFade.x, uFade.y, vUv.x);\n    gl_FragColor = vec4(color, alpha);\n    if (gl_FragColor.a < 0.0001) discard;\n    ").concat(r.WdD.fog_fragment,"\n  }\n"),v="\n  #define USE_FOG;\n  ".concat(r.WdD.fog_pars_vertex,"\n  attribute vec3 aOffset;\n  attribute vec3 aMetrics;\n  attribute vec3 aColor;\n  uniform float uTravelLength;\n  uniform float uTime;\n  varying vec2 vUv;\n  varying vec3 vColor;\n  #include <getDistortion_vertex>\n  void main() {\n    vec3 transformed = position.xyz;\n    float radius = aMetrics.r;\n    float myLength = aMetrics.g;\n    float speed = aMetrics.b;\n\n    transformed.xy *= radius;\n    transformed.z *= myLength;\n\n    transformed.z += myLength - mod(uTime * speed + aOffset.z, uTravelLength);\n    transformed.xy += aOffset.xy;\n\n    float progress = abs(transformed.z / uTravelLength);\n    transformed.xyz += getDistortion(progress);\n\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n    gl_Position = projectionMatrix * mvPosition;\n    vUv = uv;\n    vColor = aColor;\n    ").concat(r.WdD.fog_vertex,"\n  }\n");class w{init(){let t;let e=this.options,i=new o._12(1,1),n=new o.L5s().copy(i),s=e.totalSideLightSticks;n.instanceCount=s;let r=e.length/(s-1),a=[],h=[],l=[];t=Array.isArray(e.colors.sticks)?e.colors.sticks.map(t=>new o.Ilk(t)):[new o.Ilk(e.colors.sticks)];for(let i=0;i<s;i++){let n=u(e.lightStickWidth),s=u(e.lightStickHeight);a.push((i-1)*r*2+r*Math.random());let o=f(t);h.push(o.r),h.push(o.g),h.push(o.b),l.push(n),l.push(s)}n.setAttribute("aOffset",new o.lb7(new Float32Array(a),1,!1)),n.setAttribute("aColor",new o.lb7(new Float32Array(h),3,!1)),n.setAttribute("aMetrics",new o.lb7(new Float32Array(l),2,!1));let d=new o.jyz({fragmentShader:b,vertexShader:y,side:o.ehD,uniforms:Object.assign({uTravelLength:{value:e.length},uTime:{value:0}},this.webgl.fogUniforms,("object"==typeof e.distortion?e.distortion.uniforms:{})||{})});d.onBeforeCompile=t=>{t.vertexShader=t.vertexShader.replace("#include <getDistortion_vertex>","object"==typeof this.options.distortion?this.options.distortion.getDistortion:"")};let c=new o.Kj0(n,d);c.frustumCulled=!1,this.webgl.scene.add(c),this.mesh=c}update(t){this.mesh.material.uniforms.uTime&&(this.mesh.material.uniforms.uTime.value=t)}constructor(t,e){this.webgl=t,this.options=e}}let y="\n  #define USE_FOG;\n  ".concat(r.WdD.fog_pars_vertex,"\n  attribute float aOffset;\n  attribute vec3 aColor;\n  attribute vec2 aMetrics;\n  uniform float uTravelLength;\n  uniform float uTime;\n  varying vec3 vColor;\n  mat4 rotationY( in float angle ) {\n    return mat4(\n      cos(angle),		0,		sin(angle),	0,\n      0,		        1.0,	0,			0,\n      -sin(angle),	    0,		cos(angle),	0,\n      0, 		        0,		0,			1\n    );\n  }\n  #include <getDistortion_vertex>\n  void main(){\n    vec3 transformed = position.xyz;\n    float width = aMetrics.x;\n    float height = aMetrics.y;\n\n    transformed.xy *= vec2(width, height);\n    float time = mod(uTime * 60. * 2. + aOffset, uTravelLength);\n\n    transformed = (rotationY(3.14/2.) * vec4(transformed,1.)).xyz;\n    transformed.z += - uTravelLength + time;\n\n    float progress = abs(transformed.z / uTravelLength);\n    transformed.xyz += getDistortion(progress);\n\n    transformed.y += height / 2.;\n    transformed.x += -width / 2.;\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n    gl_Position = projectionMatrix * mvPosition;\n    vColor = aColor;\n    ").concat(r.WdD.fog_vertex,"\n  }\n"),b="\n  #define USE_FOG;\n  ".concat(r.WdD.fog_pars_fragment,"\n  varying vec3 vColor;\n  void main(){\n    vec3 color = vec3(vColor);\n    gl_FragColor = vec4(color,1.);\n    ").concat(r.WdD.fog_fragment,"\n  }\n");class P{createPlane(t,e,i){let n=this.options,s=new o._12(i?n.roadWidth:n.islandWidth,n.length,20,100),r={uTravelLength:{value:n.length},uColor:{value:new o.Ilk(i?n.colors.roadColor:n.colors.islandColor)},uTime:this.uTime},a=new o.jyz({fragmentShader:x,vertexShader:S,side:o.ehD,uniforms:Object.assign(r,this.webgl.fogUniforms,("object"==typeof n.distortion?n.distortion.uniforms:{})||{})});a.onBeforeCompile=t=>{t.vertexShader=t.vertexShader.replace("#include <getDistortion_vertex>","object"==typeof this.options.distortion?this.options.distortion.getDistortion:"")};let h=new o.Kj0(s,a);return h.rotation.x=-Math.PI/2,h.position.z=-n.length/2,h.position.x+=(this.options.islandWidth/2+n.roadWidth/2)*t,this.webgl.scene.add(h),h}init(){this.leftRoadWay=this.createPlane(-1,this.options.roadWidth,!0),this.rightRoadWay=this.createPlane(1,this.options.roadWidth,!0),this.island=this.createPlane(0,this.options.islandWidth,!1)}update(t){this.uTime.value=t}constructor(t,e){this.webgl=t,this.options=e,this.uTime={value:0}}}let x="\n  #define USE_FOG;\n  varying vec2 vUv;\n  uniform vec3 uColor;\n  uniform float uTime;\n  ".concat(r.WdD.fog_pars_fragment,"\n  void main() {\n    vec2 uv = vUv;\n    vec3 color = vec3(uColor);\n    gl_FragColor = vec4(color, 1.);\n    ").concat(r.WdD.fog_fragment,"\n  }\n"),S="\n  #define USE_FOG;\n  uniform float uTime;\n  ".concat(r.WdD.fog_pars_vertex,"\n  uniform float uTravelLength;\n  varying vec2 vUv;\n  #include <getDistortion_vertex>\n  void main() {\n    vec3 transformed = position.xyz;\n    vec3 distortion = getDistortion((transformed.y + uTravelLength / 2.) / uTravelLength);\n    transformed.x += distortion.x;\n    transformed.z += distortion.y;\n    transformed.y += -1. * distortion.z;\n\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n    gl_Position = projectionMatrix * mvPosition;\n    vUv = uv;\n    ").concat(r.WdD.fog_vertex,"\n  }\n");class C{onWindowResize(){let t=this.container.offsetWidth,e=this.container.offsetHeight;this.renderer.setSize(t,e),this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.composer.setSize(t,e)}initPasses(){this.renderPass=new a.CD(this.scene,this.camera),this.bloomPass=new a.H5(this.camera,new a.rk({luminanceThreshold:.3,luminanceSmoothing:.1,resolutionScale:1,intensity:.8}));let t=new a.H5(this.camera,new a.fY({preset:a.F9.MEDIUM}));this.renderPass.renderToScreen=!1,this.bloomPass.renderToScreen=!1,t.renderToScreen=!0,this.composer.addPass(this.renderPass),this.composer.addPass(this.bloomPass),this.composer.addPass(t)}init(){this.initPasses();let t=this.options;this.leftCarLights.init(),this.leftCarLights.mesh.position.setX(-t.roadWidth/2-t.islandWidth/2),this.rightCarLights.init(),this.rightCarLights.mesh.position.setX(t.roadWidth/2+t.islandWidth/2),this.leftSticks.init(),this.leftSticks.mesh.position.setX(-(t.roadWidth+t.islandWidth/2)),this.tick()}update(t){let e=Math.exp(-(-60*Math.log2(.9))*t);this.speedUp+=g(this.speedUp,this.speedUpTarget,e,1e-5),this.timeOffset+=this.speedUp*t;let i=this.clock.elapsedTime+this.timeOffset;this.rightCarLights.update(i),this.leftCarLights.update(i),this.leftSticks.update(i);let n=!1,s=g(this.camera.fov,this.fovTarget,e);if(0!==s&&(this.camera.fov+=s*t*6,n=!0),"object"==typeof this.options.distortion&&this.options.distortion.getJS){let t=this.options.distortion.getJS(.025,i);this.camera.lookAt(new o.Pa4(this.camera.position.x+t.x,this.camera.position.y+t.y,this.camera.position.z+t.z)),n=!0}n&&this.camera.updateProjectionMatrix()}render(t){this.composer.render(t)}dispose(){this.disposed=!0,this.renderer&&this.renderer.dispose(),this.composer&&this.composer.dispose(),this.scene&&this.scene.clear(),window.removeEventListener("resize",this.onWindowResize.bind(this))}setSize(t,e,i){this.composer.setSize(t,e,i)}tick(){if(this.disposed||!this)return;if(function(t,e){let i=t.domElement,n=i.clientWidth,s=i.clientHeight,o=i.width!==n||i.height!==s;return o&&e(n,s,!1),o}(this.renderer,this.setSize)){let t=this.renderer.domElement;this.camera.aspect=t.clientWidth/t.clientHeight,this.camera.updateProjectionMatrix()}let t=this.clock.getDelta();this.render(t),this.update(t),requestAnimationFrame(this.tick)}constructor(t,e){this.options=e,this.container=t,this.renderer=new r.CP7({antialias:!1,alpha:!0}),this.renderer.setSize(t.offsetWidth,t.offsetHeight,!1),this.renderer.setPixelRatio(window.devicePixelRatio),this.composer=new a.xC(this.renderer),t.appendChild(this.renderer.domElement),this.camera=new o.cPb(e.fov,t.offsetWidth/t.offsetHeight,.1,1e4),this.camera.position.z=-5,this.camera.position.y=12,this.camera.position.x=0,this.scene=new o.xsS,this.scene.background=null;let i=new o.ybr(e.colors.background,.2*e.length,500*e.length);this.scene.fog=i,this.fogUniforms={fogColor:{value:i.color},fogNear:{value:i.near},fogFar:{value:i.far}},this.clock=new o.SUY,this.disposed=!1,this.road=new P(this,e),this.leftCarLights=new m(this,e,e.colors.leftCars,e.movingAwaySpeed,new o.FM8(0,1-e.carLightsFade)),this.rightCarLights=new m(this,e,e.colors.rightCars,e.movingCloserSpeed,new o.FM8(1,0+e.carLightsFade)),this.leftSticks=new w(this,e),this.fovTarget=e.fov,this.speedUpTarget=0,this.speedUp=0,this.timeOffset=0,this.tick=this.tick.bind(this),this.init=this.init.bind(this),this.setSize=this.setSize.bind(this),window.addEventListener("resize",this.onWindowResize.bind(this))}}e.default=t=>{let{effectOptions:e={}}=t,i={...h,...e},o=(0,s.useRef)(null),r=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(r.current){r.current.dispose();let t=document.getElementById("hyperspeed");if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}let t=o.current;if(!t)return;let e={...i};"string"==typeof e.distortion&&(e.distortion=c[e.distortion]);let n=new C(t,e);return r.current=n,n.init(),()=>{r.current&&r.current.dispose()}},[]),(0,n.jsx)("div",{id:"hyperspeed",className:"w-full h-full absolute inset-0",ref:o})}}}]);