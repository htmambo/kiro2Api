(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82],{7372:function(e,t,s){Promise.resolve().then(s.bind(s,3752))},3752:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var l=s(7437),r=s(2265),a=s(1843),n=s(6695),i=s(7564);let c=(0,s(3243).Z)("outline","crown","Crown",[["path",{d:"M12 6l4 6l5 -4l-2 10h-14l-2 -10l5 4z",key:"svg-0"}]]);var d=s(9810),o=s(4746),x=s(4810),h=s(5974),u=s(3022),m=s(3149),g=s(1343);function p(){let e=(0,m.p)(),[t,s]=(0,r.useState)(null),[p,f]=(0,r.useState)(!0),[j,b]=(0,r.useState)(!1),[N,v]=(0,r.useState)(null),[y,w]=(0,r.useState)("all"),[k,C]=(0,r.useState)(null),[U,F]=(0,r.useState)(!1);(0,r.useEffect)(()=>(0,g.gD)(()=>{e.error("请先登录以继续操作")}),[e]),(0,r.useEffect)(()=>{Z(!1)},[]),(0,r.useEffect)(()=>{let e=null;return U&&(Z(!0),e=setInterval(()=>{Z(!0)},1e4)),()=>{e&&clearInterval(e)}},[U]);let Z=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];b(!0),v(null);let t=Date.now();try{let t=await (0,g.ri)(e?"/api/usage?refresh=true":"/api/usage");if(!t.ok)throw Error("加载用量数据失败");let l=await t.json();s(l)}catch(e){if((0,g.TW)(e))return;console.error("Failed to load usage stats:",e),v("加载用量数据失败")}finally{let e=Date.now()-t;e<800&&await new Promise(t=>setTimeout(t,800-e)),f(!1),b(!1)}},M=async t=>{C(t);try{if(!(await (0,g.ri)("/api/usage/".concat(t,"?refresh=true"))).ok)throw Error("刷新失败");await Z(!1),e.success("刷新成功")}catch(t){if((0,g.TW)(t))return;console.error("Failed to refresh account usage:",t),e.error("刷新失败")}finally{C(null)}},S=e=>null==e?"0%":"".concat(e.toFixed(1),"%"),T=e=>e.isDisabled||!e.isHealthy?"banned":"healthy",E=e=>"all"===y?e:e.filter(e=>T(e)===y);if(p)return(0,l.jsx)(u.y6,{});if(N)return(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("div",{className:"text-red-400",children:N})});let D=(null==t?void 0:t.providers)||{},O=(()=>{let e=0,s=0,l=0,r=0,a=0;for(let n of Object.values((null==t?void 0:t.providers)||{}))if(n.instances)for(let t of n.instances)a++,t.isHealthy&&!t.isDisabled?l++:r++,t.limits&&(e+=t.limits.total||0,s+=t.limits.used||0);let n=e-s,i=e>0?s/e*100:0;return{totalQuota:e,usedQuota:s,remainingQuota:n,percentUsed:i,healthyCount:l,bannedCount:r,totalCount:a}})();return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between animate-fade-in-up",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"用量统计"}),(0,l.jsx)("p",{className:"text-gray-400",children:"API 使用情况和配额监控"}),(null==t?void 0:t.timestamp)&&(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["更新时间: ",new Date(t.timestamp).toLocaleString("zh-CN"),t.fromCache&&(0,l.jsx)("span",{className:"ml-2 text-blue-400",children:"(缓存)"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer group",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("input",{type:"checkbox",checked:U,onChange:e=>F(e.target.checked),className:"sr-only peer"}),(0,l.jsx)("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]}),(0,l.jsxs)("span",{className:"text-sm font-medium text-gray-300 group-hover:text-white transition-colors",children:["自动刷新 ",U&&(0,l.jsx)("span",{className:"text-xs text-gray-500",children:"(10秒)"})]})]}),(0,l.jsxs)("button",{onClick:()=>Z(!0),disabled:j||U,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 rounded-lg font-semibold transition-all duration-200 hover:shadow-lg hover:shadow-purple-500/50 disabled:opacity-50 disabled:cursor-not-allowed",children:[j?(0,l.jsx)(a.Z,{className:"w-5 h-5 animate-spin"}):(0,l.jsx)(n.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:j?"刷新中...":"刷新全部"})]})]})]}),(0,l.jsx)(x.J,{className:"overflow-hidden",children:(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-6",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:(0,l.jsx)(i.Z,{className:"w-6 h-6"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-bold",children:"总额度概览"}),(0,l.jsxs)("p",{className:"text-sm text-gray-400",children:[O.totalCount," 个账号"]})]})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"已使用 / 总额度"}),(0,l.jsxs)("span",{className:"font-bold",children:[(0,l.jsx)("span",{className:O.percentUsed>80?"text-red-400":O.percentUsed>50?"text-orange-400":"text-green-400",children:O.usedQuota.toFixed(1)}),(0,l.jsx)("span",{className:"text-gray-500",children:" / "}),(0,l.jsx)("span",{className:"text-white",children:O.totalQuota.toFixed(1)})]})]}),(0,l.jsx)("div",{className:"h-4 bg-white/10 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full transition-all duration-500 ".concat(O.percentUsed>80?"bg-gradient-to-r from-red-500 to-pink-600":O.percentUsed>50?"bg-gradient-to-r from-orange-500 to-yellow-500":"bg-gradient-to-r from-green-500 to-emerald-600"),style:{width:"".concat(Math.min(O.percentUsed,100),"%")}})}),(0,l.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,l.jsxs)("span",{children:[O.percentUsed.toFixed(1),"% 已使用"]}),(0,l.jsxs)("span",{children:["剩余 ",O.remainingQuota.toFixed(1)]})]})]})]}),(0,l.jsxs)("div",{className:"lg:w-64 lg:border-l lg:border-white/10 lg:pl-6",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"按状态筛选"}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsxs)("button",{onClick:()=>w("all"),className:"text-center p-3 rounded-lg border transition-all ".concat("all"===y?"bg-blue-500/20 border-blue-500/50 ring-2 ring-blue-500":"bg-white/5 border-white/10 hover:bg-white/10"),children:[(0,l.jsx)("div",{className:"text-lg font-bold",children:O.totalCount}),(0,l.jsx)("div",{className:"text-xs text-gray-400",children:"全部"})]}),(0,l.jsxs)("button",{onClick:()=>w("healthy"),className:"text-center p-3 rounded-lg border transition-all ".concat("healthy"===y?"bg-green-500/20 border-green-500/50 ring-2 ring-green-500":"bg-white/5 border-white/10 hover:bg-white/10"),children:[(0,l.jsx)("div",{className:"text-lg font-bold text-green-400",children:O.healthyCount}),(0,l.jsx)("div",{className:"text-xs text-gray-400",children:"健康"})]}),(0,l.jsxs)("button",{onClick:()=>w("banned"),className:"text-center p-3 rounded-lg border transition-all ".concat("banned"===y?"bg-red-500/20 border-red-500/50 ring-2 ring-red-500":"bg-white/5 border-white/10 hover:bg-white/10"),children:[(0,l.jsx)("div",{className:"text-lg font-bold text-red-400",children:O.bannedCount}),(0,l.jsx)("div",{className:"text-xs text-gray-400",children:"异常"})]})]})]})]})}),Object.entries(D).map(e=>{let[t,s]=e,r=E(s.instances||[]);return 0===r.length?null:(0,l.jsx)(x.J,{noBackground:!0,noPadding:!0,children:(0,l.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:r.map((e,t)=>{let s=T(e),r=k===e.uuid;return(0,l.jsxs)("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"font-medium text-sm",title:e.email,children:e.email||"账户 ".concat(t+1)}),"healthy"===s?(0,l.jsx)(h.C,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"健康"}):(0,l.jsx)(h.C,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"异常"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[e.subscription&&(0,l.jsxs)(h.C,{variant:"outline",className:"flex items-center gap-1",children:[(0,l.jsx)(c,{className:"w-3 h-3"}),e.subscription.title]}),(0,l.jsx)("button",{onClick:()=>M(e.uuid),disabled:r,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",title:"刷新此账号用量",children:r?(0,l.jsx)(a.Z,{className:"w-4 h-4 animate-spin"}):(0,l.jsx)(n.Z,{className:"w-4 h-4"})})]})]}),e.credentialsPath&&(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-3 text-xs text-gray-500",children:[(0,l.jsx)(d.Z,{className:"w-3 h-3"}),(0,l.jsx)("span",{className:"truncate",title:e.credentialsPath,children:e.credentialsPath})]}),e.limits&&(0,l.jsxs)("div",{className:"mb-4 p-3 rounded-lg bg-white/5",children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"总用量"}),(0,l.jsxs)("span",{className:"font-medium",children:[(e.limits.used||0).toFixed(2)," / ",(e.limits.total||0).toFixed(2)]})]}),(0,l.jsx)("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden mb-1",children:(0,l.jsx)("div",{className:"h-full transition-all ".concat((e.limits.percentUsed||0)>90?"bg-red-500":(e.limits.percentUsed||0)>70?"bg-orange-500":"bg-gradient-to-r from-green-500 to-emerald-600"),style:{width:"".concat(Math.min(e.limits.percentUsed||0,100),"%")}})}),(0,l.jsx)("p",{className:"text-xs text-gray-500 text-right",children:S(e.limits.percentUsed)})]}),e.usageBreakdown&&e.usageBreakdown.length>0&&(0,l.jsx)("div",{className:"space-y-2 mb-3",children:e.usageBreakdown.map((e,t)=>(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between text-gray-400",children:[(0,l.jsx)("span",{children:e.displayName}),(0,l.jsxs)("span",{children:[(e.currentUsage||0).toFixed(2)," / ",(e.usageLimit||0).toFixed(2)]})]}),e.freeTrial&&(0,l.jsxs)("div",{className:"mt-1 pl-3 border-l-2 border-purple-500/50",children:[(0,l.jsxs)("div",{className:"flex justify-between text-xs text-purple-400",children:[(0,l.jsx)("span",{children:"免费试用"}),(0,l.jsxs)("span",{children:[(e.freeTrial.currentUsage||0).toFixed(2)," / ",(e.freeTrial.usageLimit||0).toFixed(2)]})]}),e.freeTrial.expiresAt&&(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["到期: ",new Date(e.freeTrial.expiresAt).toLocaleString("zh-CN")]})]})]},t))}),(0,l.jsxs)("div",{className:"pt-3 border-t border-white/10 grid grid-cols-2 gap-2 text-xs text-gray-400",children:[void 0!==e.usageCount&&(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"使用次数:"}),(0,l.jsx)("span",{className:"text-white",children:e.usageCount})]}),void 0!==e.errorCount&&e.errorCount>0&&(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"错误次数:"}),(0,l.jsx)("span",{className:"text-red-400",children:e.errorCount})]}),void 0!==e.daysUntilReset&&(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"重置倒计时:"}),(0,l.jsxs)("span",{className:"text-blue-400",children:[e.daysUntilReset," 天"]})]})]})]},e.uuid||t)})})},t)}),0===Object.keys(D).length&&(0,l.jsx)(x.J,{children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)(o.Z,{className:"w-12 h-12 mx-auto text-gray-600 mb-4"}),(0,l.jsx)("p",{className:"text-gray-400 text-lg",children:"暂无用量数据"}),(0,l.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"配置提供商后将在此显示用量统计"})]})}),Object.keys(D).length>0&&Object.values(D).every(e=>0===E(e.instances||[]).length)&&(0,l.jsx)(x.J,{children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsxs)("p",{className:"text-gray-400 text-lg",children:["healthy"===y?"健康池":"异常池","暂无账号"]}),(0,l.jsx)("button",{onClick:()=>w("all"),className:"mt-4 text-blue-400 hover:underline",children:"查看全部账号"})]})})]})}},4746:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(3243).Z)("outline","chart-line","ChartLine",[["path",{d:"M4 19l16 0",key:"svg-0"}],["path",{d:"M4 15l4 -6l4 2l4 -5l4 4",key:"svg-1"}]])},9810:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(3243).Z)("outline","file","File",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}]])},7564:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(3243).Z)("outline","trending-up","TrendingUp",[["path",{d:"M3 17l6 -6l4 4l8 -8",key:"svg-0"}],["path",{d:"M14 7l7 0l0 7",key:"svg-1"}]])}},function(e){e.O(0,[582,29,976,971,117,744],function(){return e(e.s=7372)}),_N_E=e.O()}]);