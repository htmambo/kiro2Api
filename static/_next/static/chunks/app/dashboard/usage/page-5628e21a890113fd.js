(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82],{7372:function(e,t,s){Promise.resolve().then(s.bind(s,3752))},3752:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var l=s(7437),a=s(2265),r=s(1843),n=s(6695),i=s(7564);let c=(0,s(3243).Z)("outline","crown","Crown",[["path",{d:"M12 6l4 6l5 -4l-2 10h-14l-2 -10l5 4z",key:"svg-0"}]]);var d=s(9810),o=s(4746),x=s(4810),h=s(5974),m=s(3022),u=s(3149);function g(){let e=(0,u.p)(),[t,s]=(0,a.useState)(null),[g,p]=(0,a.useState)(!0),[j,f]=(0,a.useState)(!1),[b,N]=(0,a.useState)(null),[v,y]=(0,a.useState)("all"),[w,k]=(0,a.useState)(null),[C,U]=(0,a.useState)(!1);(0,a.useEffect)(()=>{F(!1)},[]),(0,a.useEffect)(()=>{let e=null;return C&&(F(!0),e=setInterval(()=>{F(!0)},1e4)),()=>{e&&clearInterval(e)}},[C]);let F=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];f(!0),N(null);let t=Date.now();try{let t=localStorage.getItem("authToken"),l=await fetch(e?"/api/usage?refresh=true":"/api/usage",{headers:{Authorization:"Bearer ".concat(t)}});if(l.ok){let e=await l.json();s(e)}else N("加载用量数据失败")}catch(e){console.error("Failed to load usage stats:",e),N("加载用量数据失败")}finally{let e=Date.now()-t;e<800&&await new Promise(t=>setTimeout(t,800-e)),p(!1),f(!1)}},Z=async(t,s)=>{k(s);try{let l=localStorage.getItem("authToken");(await fetch("/api/usage/".concat(t,"/").concat(s,"?refresh=true"),{headers:{Authorization:"Bearer ".concat(l)}})).ok?(await F(!1),e.success("刷新成功")):e.error("刷新失败")}catch(t){console.error("Failed to refresh account usage:",t),e.error("刷新失败")}finally{k(null)}},S=e=>null==e?"0%":"".concat(e.toFixed(1),"%"),M=e=>e.isDisabled||!e.isHealthy?"banned":"healthy",T=e=>"all"===v?e:e.filter(e=>M(e)===v);if(g)return(0,l.jsx)(m.y6,{});if(b)return(0,l.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,l.jsx)("div",{className:"text-red-400",children:b})});let O=(null==t?void 0:t.providers)||{},z=(()=>{let e=0,s=0,l=0,a=0,r=0;for(let n of Object.values((null==t?void 0:t.providers)||{}))if(n.instances)for(let t of n.instances)r++,t.isHealthy&&!t.isDisabled?l++:a++,t.limits&&(e+=t.limits.total||0,s+=t.limits.used||0);let n=e-s,i=e>0?s/e*100:0;return{totalQuota:e,usedQuota:s,remainingQuota:n,percentUsed:i,healthyCount:l,bannedCount:a,totalCount:r}})();return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between animate-fade-in-up",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"用量统计"}),(0,l.jsx)("p",{className:"text-gray-400",children:"API 使用情况和配额监控"}),(null==t?void 0:t.timestamp)&&(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["更新时间: ",new Date(t.timestamp).toLocaleString("zh-CN"),t.fromCache&&(0,l.jsx)("span",{className:"ml-2 text-blue-400",children:"(缓存)"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer group",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("input",{type:"checkbox",checked:C,onChange:e=>U(e.target.checked),className:"sr-only peer"}),(0,l.jsx)("div",{className:"w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]}),(0,l.jsxs)("span",{className:"text-sm font-medium text-gray-300 group-hover:text-white transition-colors",children:["自动刷新 ",C&&(0,l.jsx)("span",{className:"text-xs text-gray-500",children:"(10秒)"})]})]}),(0,l.jsxs)("button",{onClick:()=>F(!0),disabled:j||C,className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 rounded-lg font-semibold transition-all duration-200 hover:shadow-lg hover:shadow-purple-500/50 disabled:opacity-50 disabled:cursor-not-allowed",children:[j?(0,l.jsx)(r.Z,{className:"w-5 h-5 animate-spin"}):(0,l.jsx)(n.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:j?"刷新中...":"刷新全部"})]})]})]}),(0,l.jsx)(x.J,{className:"overflow-hidden",children:(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-6",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:(0,l.jsx)(i.Z,{className:"w-6 h-6"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-bold",children:"总额度概览"}),(0,l.jsxs)("p",{className:"text-sm text-gray-400",children:[z.totalCount," 个账号"]})]})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"已使用 / 总额度"}),(0,l.jsxs)("span",{className:"font-bold",children:[(0,l.jsx)("span",{className:z.percentUsed>80?"text-red-400":z.percentUsed>50?"text-orange-400":"text-green-400",children:z.usedQuota.toFixed(1)}),(0,l.jsx)("span",{className:"text-gray-500",children:" / "}),(0,l.jsx)("span",{className:"text-white",children:z.totalQuota.toFixed(1)})]})]}),(0,l.jsx)("div",{className:"h-4 bg-white/10 rounded-full overflow-hidden",children:(0,l.jsx)("div",{className:"h-full transition-all duration-500 ".concat(z.percentUsed>80?"bg-gradient-to-r from-red-500 to-pink-600":z.percentUsed>50?"bg-gradient-to-r from-orange-500 to-yellow-500":"bg-gradient-to-r from-green-500 to-emerald-600"),style:{width:"".concat(Math.min(z.percentUsed,100),"%")}})}),(0,l.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,l.jsxs)("span",{children:[z.percentUsed.toFixed(1),"% 已使用"]}),(0,l.jsxs)("span",{children:["剩余 ",z.remainingQuota.toFixed(1)]})]})]})]}),(0,l.jsxs)("div",{className:"lg:w-64 lg:border-l lg:border-white/10 lg:pl-6",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"按状态筛选"}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsxs)("button",{onClick:()=>y("all"),className:"text-center p-3 rounded-lg border transition-all ".concat("all"===v?"bg-blue-500/20 border-blue-500/50 ring-2 ring-blue-500":"bg-white/5 border-white/10 hover:bg-white/10"),children:[(0,l.jsx)("div",{className:"text-lg font-bold",children:z.totalCount}),(0,l.jsx)("div",{className:"text-xs text-gray-400",children:"全部"})]}),(0,l.jsxs)("button",{onClick:()=>y("healthy"),className:"text-center p-3 rounded-lg border transition-all ".concat("healthy"===v?"bg-green-500/20 border-green-500/50 ring-2 ring-green-500":"bg-white/5 border-white/10 hover:bg-white/10"),children:[(0,l.jsx)("div",{className:"text-lg font-bold text-green-400",children:z.healthyCount}),(0,l.jsx)("div",{className:"text-xs text-gray-400",children:"健康"})]}),(0,l.jsxs)("button",{onClick:()=>y("banned"),className:"text-center p-3 rounded-lg border transition-all ".concat("banned"===v?"bg-red-500/20 border-red-500/50 ring-2 ring-red-500":"bg-white/5 border-white/10 hover:bg-white/10"),children:[(0,l.jsx)("div",{className:"text-lg font-bold text-red-400",children:z.bannedCount}),(0,l.jsx)("div",{className:"text-xs text-gray-400",children:"异常"})]})]})]})]})}),Object.entries(O).map(e=>{var t;let[s,a]=e,i=T(a.instances||[]);return 0===i.length?null:(0,l.jsx)(x.J,{children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-xl font-bold",children:s}),(0,l.jsxs)(h.C,{variant:"secondary",children:[i.length," / ",(null===(t=a.instances)||void 0===t?void 0:t.length)||0," 个账户"]})]}),(0,l.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:i.map((e,t)=>{let a=M(e),i=w===e.uuid;return(0,l.jsxs)("div",{className:"p-4 rounded-lg bg-white/5 border border-white/10",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"font-medium text-sm",title:e.email,children:e.email||"账户 ".concat(t+1)}),"healthy"===a?(0,l.jsx)(h.C,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"健康"}):(0,l.jsx)(h.C,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"异常"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[e.subscription&&(0,l.jsxs)(h.C,{variant:"outline",className:"flex items-center gap-1",children:[(0,l.jsx)(c,{className:"w-3 h-3"}),e.subscription.title]}),(0,l.jsx)("button",{onClick:()=>Z(s,e.uuid),disabled:i,className:"p-1.5 rounded-lg hover:bg-white/10 transition-colors disabled:opacity-50",title:"刷新此账号用量",children:i?(0,l.jsx)(r.Z,{className:"w-4 h-4 animate-spin"}):(0,l.jsx)(n.Z,{className:"w-4 h-4"})})]})]}),e.credentialsPath&&(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-3 text-xs text-gray-500",children:[(0,l.jsx)(d.Z,{className:"w-3 h-3"}),(0,l.jsx)("span",{className:"truncate",title:e.credentialsPath,children:e.credentialsPath})]}),e.limits&&(0,l.jsxs)("div",{className:"mb-4 p-3 rounded-lg bg-white/5",children:[(0,l.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,l.jsx)("span",{className:"text-gray-400",children:"总用量"}),(0,l.jsxs)("span",{className:"font-medium",children:[(e.limits.used||0).toFixed(2)," / ",(e.limits.total||0).toFixed(2)]})]}),(0,l.jsx)("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden mb-1",children:(0,l.jsx)("div",{className:"h-full transition-all ".concat((e.limits.percentUsed||0)>90?"bg-red-500":(e.limits.percentUsed||0)>70?"bg-orange-500":"bg-gradient-to-r from-green-500 to-emerald-600"),style:{width:"".concat(Math.min(e.limits.percentUsed||0,100),"%")}})}),(0,l.jsx)("p",{className:"text-xs text-gray-500 text-right",children:S(e.limits.percentUsed)})]}),e.usageBreakdown&&e.usageBreakdown.length>0&&(0,l.jsx)("div",{className:"space-y-2 mb-3",children:e.usageBreakdown.map((e,t)=>(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between text-gray-400",children:[(0,l.jsx)("span",{children:e.displayName}),(0,l.jsxs)("span",{children:[(e.currentUsage||0).toFixed(2)," / ",(e.usageLimit||0).toFixed(2)]})]}),e.freeTrial&&(0,l.jsxs)("div",{className:"mt-1 pl-3 border-l-2 border-purple-500/50",children:[(0,l.jsxs)("div",{className:"flex justify-between text-xs text-purple-400",children:[(0,l.jsx)("span",{children:"免费试用"}),(0,l.jsxs)("span",{children:[(e.freeTrial.currentUsage||0).toFixed(2)," / ",(e.freeTrial.usageLimit||0).toFixed(2)]})]}),e.freeTrial.expiresAt&&(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["到期: ",new Date(e.freeTrial.expiresAt).toLocaleString("zh-CN")]})]})]},t))}),(0,l.jsxs)("div",{className:"pt-3 border-t border-white/10 grid grid-cols-2 gap-2 text-xs text-gray-400",children:[void 0!==e.usageCount&&(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"使用次数:"}),(0,l.jsx)("span",{className:"text-white",children:e.usageCount})]}),void 0!==e.errorCount&&e.errorCount>0&&(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"错误次数:"}),(0,l.jsx)("span",{className:"text-red-400",children:e.errorCount})]}),void 0!==e.daysUntilReset&&(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"重置倒计时:"}),(0,l.jsxs)("span",{className:"text-blue-400",children:[e.daysUntilReset," 天"]})]})]})]},e.uuid||t)})})]})},s)}),0===Object.keys(O).length&&(0,l.jsx)(x.J,{children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsx)(o.Z,{className:"w-12 h-12 mx-auto text-gray-600 mb-4"}),(0,l.jsx)("p",{className:"text-gray-400 text-lg",children:"暂无用量数据"}),(0,l.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"配置提供商后将在此显示用量统计"})]})}),Object.keys(O).length>0&&Object.values(O).every(e=>0===T(e.instances||[]).length)&&(0,l.jsx)(x.J,{children:(0,l.jsxs)("div",{className:"text-center py-12",children:[(0,l.jsxs)("p",{className:"text-gray-400 text-lg",children:["healthy"===v?"健康池":"异常池","暂无账号"]}),(0,l.jsx)("button",{onClick:()=>y("all"),className:"mt-4 text-blue-400 hover:underline",children:"查看全部账号"})]})})]})}},4746:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(3243).Z)("outline","chart-line","ChartLine",[["path",{d:"M4 19l16 0",key:"svg-0"}],["path",{d:"M4 15l4 -6l4 2l4 -5l4 4",key:"svg-1"}]])},9810:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(3243).Z)("outline","file","File",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}]])},7564:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(3243).Z)("outline","trending-up","TrendingUp",[["path",{d:"M3 17l6 -6l4 4l8 -8",key:"svg-0"}],["path",{d:"M14 7l7 0l0 7",key:"svg-1"}]])}},function(e){e.O(0,[582,29,982,971,117,744],function(){return e(e.s=7372)}),_N_E=e.O()}]);