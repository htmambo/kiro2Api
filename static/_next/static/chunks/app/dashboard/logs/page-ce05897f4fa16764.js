(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{7601:function(e,r,t){Promise.resolve().then(t.bind(t,967))},967:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return m}});var a=t(7437),l=t(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter((e,r,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===r).join(" ").trim()};var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,l.forwardRef)((e,r)=>{let{color:t="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:i,className:o="",children:c,iconNode:x,...g}=e;return(0,l.createElement)("svg",{ref:r,...d,width:a,height:a,stroke:t,strokeWidth:i?24*Number(s)/Number(a):s,className:n("lucide",o),...g},[...x.map(e=>{let[r,t]=e;return(0,l.createElement)(r,t)}),...Array.isArray(c)?c:[c]])}),o=(e,r)=>{let t=(0,l.forwardRef)((t,a)=>{let{className:d,...o}=t;return(0,l.createElement)(i,{ref:a,iconNode:r,className:n("lucide-".concat(s(e)),d),...o})});return t.displayName="".concat(e),t},c=o("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),x=o("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),g=o("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),h=o("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),u=o("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function m(){let[e,r]=(0,l.useState)([]),[t,s]=(0,l.useState)([]),[n,d]=(0,l.useState)(!0),[i,o]=(0,l.useState)(null),[m,y]=(0,l.useState)(!0),[f,b]=(0,l.useState)("all"),[p,k]=(0,l.useState)(""),v=(0,l.useRef)(null),j=(0,l.useRef)(null),w=()=>{m&&v.current&&v.current.scrollIntoView({behavior:"smooth"})};(0,l.useEffect)(()=>{w()},[e,m]);let N=async()=>{try{d(!0);let e=localStorage.getItem("token"),t=await fetch("/api/logs",{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("获取日志失败");let a=await t.json();r(a),o(null)}catch(e){o(e instanceof Error?e.message:"获取日志失败")}finally{d(!1)}},E=async()=>{if(confirm("确定要清空所有日志吗？"))try{let e=localStorage.getItem("token");if(!(await fetch("/api/logs",{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}})).ok)throw Error("清空日志失败");r([]),o(null)}catch(e){o(e instanceof Error?e.message:"清空日志失败")}};(0,l.useEffect)(()=>{let r=e;"all"!==f&&(r=r.filter(e=>e.level===f)),p&&(r=r.filter(e=>e.message.toLowerCase().includes(p.toLowerCase()))),s(r)},[e,f,p]),(0,l.useEffect)(()=>{N();let e=new EventSource("/api/events");return j.current=e,e.addEventListener("log",e=>{try{let t=JSON.parse(e.data);r(e=>{let r=[...e,t];return r.length>100?r.slice(-100):r})}catch(e){console.error("解析日志事件失败:",e)}}),e.onerror=e=>{console.error("SSE 连接错误:",e)},()=>{e.close()}},[]);let S=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),C=e=>{switch(e){case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}};return n&&0===e.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"加载日志中..."})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"系统日志"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"查看系统运行日志，最多保留 100 条最新记录"})]}),i&&(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-red-800 dark:text-red-200",children:i})}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 flex-1 w-full sm:w-auto",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-[200px]",children:[(0,a.jsx)(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"搜索日志...",value:p,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x,{className:"h-4 w-4 text-gray-500"}),(0,a.jsxs)("select",{value:f,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"all",children:"全部级别"}),(0,a.jsx)("option",{value:"info",children:"信息"}),(0,a.jsx)("option",{value:"error",children:"错误"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,a.jsxs)("button",{onClick:N,className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(g,{className:"h-4 w-4"}),"刷新"]}),(0,a.jsxs)("button",{onClick:()=>{let r=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),t=URL.createObjectURL(r),a=document.createElement("a");a.href=t,a.download="logs-".concat(new Date().toISOString(),".json"),a.click(),URL.revokeObjectURL(t)},disabled:0===e.length,className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(h,{className:"h-4 w-4"}),"导出"]}),(0,a.jsxs)("button",{onClick:E,disabled:0===e.length,className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(u,{className:"h-4 w-4"}),"清空"]})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"autoScroll",checked:m,onChange:e=>y(e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,a.jsx)("label",{htmlFor:"autoScroll",className:"text-sm text-gray-700 dark:text-gray-300",children:"自动滚动到最新日志"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"总日志数"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:t.length})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"信息日志"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400 mt-1",children:t.filter(e=>"info"===e.level).length})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"错误日志"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mt-1",children:t.filter(e=>"error"===e.level).length})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"日志记录"})}),(0,a.jsx)("div",{className:"p-4 max-h-[600px] overflow-y-auto",children:0===t.length?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:p||"all"!==f?"没有符合条件的日志":"暂无日志记录"}):(0,a.jsxs)("div",{className:"space-y-2",children:[t.map((e,r)=>(0,a.jsxs)("div",{className:"flex gap-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,a.jsx)("div",{className:"flex-shrink-0 text-xs text-gray-500 dark:text-gray-400 font-mono w-36",children:S(e.timestamp)}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(C(e.level)),children:e.level.toUpperCase()})}),(0,a.jsx)("div",{className:"flex-1 text-sm text-gray-900 dark:text-gray-100 font-mono break-all",children:e.message})]},r)),(0,a.jsx)("div",{ref:v})]})})]})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7601)}),_N_E=e.O()}]);