(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{7601:function(e,t,r){Promise.resolve().then(r.bind(r,967))},967:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var a=r(7437),l=r(2265);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,l.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:o,className:d="",children:c,iconNode:u,...x}=e;return(0,l.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:o?24*Number(s)/Number(a):s,className:n("lucide",d),...x},[...u.map(e=>{let[t,r]=e;return(0,l.createElement)(t,r)}),...Array.isArray(c)?c:[c]])}),d=(e,t)=>{let r=(0,l.forwardRef)((r,a)=>{let{className:i,...d}=r;return(0,l.createElement)(o,{ref:a,iconNode:t,className:n("lucide-".concat(s(e)),i),...d})});return r.displayName="".concat(e),r},c=d("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),u=d("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),x=d("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),g=d("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),h=d("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var f=r(1343);function m(){let[e,t]=(0,l.useState)([]),[r,s]=(0,l.useState)([]),[n,i]=(0,l.useState)(!0),[o,d]=(0,l.useState)(null),[m,y]=(0,l.useState)(!0),[b,p]=(0,l.useState)("all"),[w,k]=(0,l.useState)(""),v=(0,l.useRef)(null),j=(0,l.useRef)(null),N=()=>{m&&v.current&&v.current.scrollIntoView({behavior:"smooth"})};(0,l.useEffect)(()=>{N()},[e,m]);let E=async()=>{try{i(!0);let e=await (0,f.ri)("/api/logs");if(!e.ok)throw Error("获取日志失败");let r=await e.json();t(r),d(null)}catch(e){if((0,f.TW)(e))return;d(e instanceof Error?e.message:"获取日志失败")}finally{i(!1)}},S=async()=>{if(confirm("确定要清空所有日志吗？"))try{if(!(await (0,f.ri)("/api/logs",{method:"DELETE"})).ok)throw Error("清空日志失败");t([]),d(null)}catch(e){if((0,f.TW)(e))return;d(e instanceof Error?e.message:"清空日志失败")}};(0,l.useEffect)(()=>{let t=e;"all"!==b&&(t=t.filter(e=>e.level===b)),w&&(t=t.filter(e=>e.message.toLowerCase().includes(w.toLowerCase()))),s(t)},[e,b,w]),(0,l.useEffect)(()=>{E();let e=new EventSource("/api/events");return j.current=e,e.addEventListener("log",e=>{try{let r=JSON.parse(e.data);t(e=>{let t=[...e,r];return t.length>100?t.slice(-100):t})}catch(e){console.error("解析日志事件失败:",e)}}),e.onerror=e=>{console.error("SSE 连接错误:",e)},()=>{e.close()}},[]);let C=e=>new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),L=e=>{switch(e){case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}};return n&&0===e.length?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"加载日志中..."})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"系统日志"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"查看系统运行日志，最多保留 100 条最新记录"})]}),o&&(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-red-800 dark:text-red-200",children:o})}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 flex-1 w-full sm:w-auto",children:[(0,a.jsxs)("div",{className:"relative flex-1 min-w-[200px]",children:[(0,a.jsx)(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)("input",{type:"text",placeholder:"搜索日志...",value:w,onChange:e=>k(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u,{className:"h-4 w-4 text-gray-500"}),(0,a.jsxs)("select",{value:b,onChange:e=>p(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"all",children:"全部级别"}),(0,a.jsx)("option",{value:"info",children:"信息"}),(0,a.jsx)("option",{value:"error",children:"错误"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:[(0,a.jsxs)("button",{onClick:E,className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(x,{className:"h-4 w-4"}),"刷新"]}),(0,a.jsxs)("button",{onClick:()=>{let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="logs-".concat(new Date().toISOString(),".json"),a.click(),URL.revokeObjectURL(r)},disabled:0===e.length,className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(g,{className:"h-4 w-4"}),"导出"]}),(0,a.jsxs)("button",{onClick:S,disabled:0===e.length,className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(h,{className:"h-4 w-4"}),"清空"]})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"autoScroll",checked:m,onChange:e=>y(e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,a.jsx)("label",{htmlFor:"autoScroll",className:"text-sm text-gray-700 dark:text-gray-300",children:"自动滚动到最新日志"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"总日志数"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:r.length})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"信息日志"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400 mt-1",children:r.filter(e=>"info"===e.level).length})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"错误日志"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mt-1",children:r.filter(e=>"error"===e.level).length})]})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[(0,a.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"日志记录"})}),(0,a.jsx)("div",{className:"p-4 max-h-[600px] overflow-y-auto",children:0===r.length?(0,a.jsx)("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:w||"all"!==b?"没有符合条件的日志":"暂无日志记录"}):(0,a.jsxs)("div",{className:"space-y-2",children:[r.map((e,t)=>(0,a.jsxs)("div",{className:"flex gap-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:[(0,a.jsx)("div",{className:"flex-shrink-0 text-xs text-gray-500 dark:text-gray-400 font-mono w-36",children:C(e.timestamp)}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(L(e.level)),children:e.level.toUpperCase()})}),(0,a.jsx)("div",{className:"flex-1 text-sm text-gray-900 dark:text-gray-100 font-mono break-all",children:e.message})]},t)),(0,a.jsx)("div",{ref:v})]})})]})]})}},1343:function(e,t,r){"use strict";r.d(t,{TW:function(){return d},gD:function(){return n},ri:function(){return c}});class a extends Error{constructor(e="Unauthorized"){super(e),this.name="UnauthorizedError",Object.setPrototypeOf(this,a.prototype)}}let l=null,s=null;function n(e){return l=e,()=>{l===e&&(l=null)}}async function i(e){if(!function(e){let t=e.headers.get("content-type");return null!==t&&t.toLowerCase().includes("application/json")}(e))return null;try{return await e.clone().json()}catch(e){return null}}async function o(){if(null!==s){await s;return}s=(async()=>{try{localStorage.removeItem("authToken"),null!==l&&await Promise.resolve(l()),window.location.replace("/login")}catch(e){console.error("Error during unauthorized flow:",e),window.location.replace("/login")}})().finally(()=>{s=null}),await s}function d(e){return e instanceof a}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new Headers(t.headers),l=localStorage.getItem("authToken");null===l||r.has("Authorization")||r.set("Authorization","Bearer ".concat(l));let s=await fetch(e,{...t,headers:r});if(401===s.status)throw await o(),new a("HTTP 401 Unauthorized");let n=await i(s);if(n&&"UNAUTHORIZED"===n.code)throw await o(),new a("API returned UNAUTHORIZED code");return s}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7601)}),_N_E=e.O()}]);